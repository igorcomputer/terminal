## Команды консоли (терминал)

**Примечание:**  
в консоли не работает команда вставки (CTRL+V), необходимо пользоваться конекстным меню (правой кнопкой мыши - (вставить))

Если команда выдает символ **"->"** и не реагирует, значит консоль ожидает продолжения или конца ввода.  
В этом случае необходимо ввести **";"  
**

**> ^C**  - (CTRL+C) прерывание текущей команды

**> history** - просмотр истории

**Подключение к сайту по SSH средствами Mac OS.** Запускаем терминал и пишем:  
> **ssh '-p 2200' root@178.154.84** — подключение к серверу c указанием порта (-p), далее жмем <Enter> и затем идет запрос пароля (вводим пароль)

**Подключение к терминалу средствами эклипса:**  
В установленном соединении выбираем SSH и в контексном меню пункт  "launch terminal".

> **clear** — очистка консоли

> **man cd** - вызов справки для команды cd (для остальных команд аналогично)

### Навигация по каталогам

> **pwd** — показать текущий путь

> **cd dir1** — перейти в каталог dir1  
> **cd ..** — перейти в каталог на уровень выше  
> **cd ~** — перейти в домашний каталог текущего пользователя

> **ls -l** — показать файлы в текущем каталоге (расширенный вид)  
> **ls -a** — показать скрытые файлы

### Создание и копирование файлов

> **touch file1.txt** — создать файл file1.txt

> **cp file1 dir1** — скопировать файл file1 в каталог dir1  

> **mkdir dir1** — создать каталог dir1

**Скопировать каталог в каталог:**

cp -R ihc-russia.ru/min vse-svoi.ru

### Перемещение и переименование файлов

> **mv file1.txt newfile.txt** — переименовать файл file1.txt в файл newfile.txt  
> **mv file.txt dir1** — перенести файл file.txt в каталог dir1  
> **mv file.txt ..** — перенос файла на уровень выше  
> **mv file.txt ~/dir** — перенос файла в каталог dir домашнего каталога

### Открытие и изменение файлов

> **cat file.txt** — открыть файл file.txt в консоли

> **nano file.txt** — открыть файл file.txt в редакторе nano (если нет прав на редактирование файла, файл откроется только в режиме просмотра, см. следующую команду)  
**для выхода из редактора nano используется команда (Ctrl+X)**

> **nano file.txt** — открыть файл c правами администратора (с возможностью редактирования)  
> **sudo nano /etc/hosts** — открыть файл hosts c правами администратора

### **Установка прав на файлы и каталоги**

> **ls -l** — список файлов и каталогов (префикс d в первом столбце) с указанием прав  

**Для битрикса необходимы следующие права:**

_775 - права на каталоги_  
_664 - права на файлы_

> **chown -R bitrix:bitrix ./** — Установка владельца и группы для текущего каталога (./) R-рекурсия, пользователь:группа ./ - текущий каталог

> **cmod -R 0777 ./** — установка прав 007 на файлы и папки (выполняется для файлов и папок текущего каталога)

**<span style="text-decoration:underline">Раздельная установка прав (755 для каталогов (-type d), 644 для файлов (-type f)) - самый правильный способ:</span>**

>  **find ./ \( -type d -exec chmod 775 '{}' \; \) , \( -type f -exec chmod 664 '{}' \; \)**

**Другой вариант (проще)  
**

**cd ~/www  
<span style="text-decoration:underline">find . -type d -exec chmod 755 {} \;</span>  
<span style="text-decoration:underline">find . -type f -exec chmod 644 {} \;</span>  
find . -type d -exec chown bitrix:bitrix {} \;  
find . -type f -exec chown bitrix:bitrix {} \;**

### Удаление файлов и каталогов

> **rm file1.txt** — Удалить файл file1.txt  
> **rm dir -r** — Удалить каталог dir (ключ -r означает рекурсивное удаление). Для пустых каталогов ключ -r можно не использовать.

### Работа с процессами (утилиты для мониторинга системы)

> **top** — показать список текущих процессов и их параметры  
(к сожалению невозможно увидеть весь список, если он большой, нет возможности листать)  
Для выхода из режима просмотра процессов, используются клавиши CTRL+Z или Q)

> **ps auxw** — показать слепок процессов (PID - ID процесса).

> **kill PID** — убить процесс по его PID.  
Примечание: находим процесс который кушает очень много памяти, находим его PID и можем таким образом убить процесс используя команду kill и его PID.  

**Для подключения к терминалу на удаленном сервере в списке дерева в эклипсе:**  
- выбираем нужный сервер и на значке **ssh terminals** правой кнопкой мышки ждем **lanch terminal**

Процессы, которые необходимо контролировать на серверах:

**httpd** - демон апача  
**nginx** - веб сервер nginx  
**mysqld** - демон mysql

Команды для проверки статусов:

> **service httpd status**  
> **service nginx status**  
> **service mysqld status**

Перезапуск демонов: например для  httpd (для остальных аналогично)

> **service httpd stop** — остановка демона> **service httpd start** — запуск демона> **service httpd restart** — рестарт демона (аналогично start и stop)

### Дополнительные утилиты

> **free** — показывает состояние оперативной памяти в байтах  
> **free -m** — в мегабайтах  
> **free -h** — в гигабайтах

Примечание: +/- buffer/cash — дополнительная файловая память

> **df -h** — cостояние HDD (использованная память в Гагабайтах), вывод данных с разбивкой по разделам жесткого диска

> **mount** — вывод списка разделов жесткого диска

> **fdisk -l** — получение информации о жестких дисках с учетом разбивки на разделы

### Удаленное подключение к компьютеру

> **ssh login@10.01.143** — Подключение к комьпютеру c IP = 10.01.143 с логином login  
> **ssh '-p 2200' root@178.154.84 ** - подключение с указанием порта

> **kill finder** — завершить программу finder на удаленном компе

### Узнаем размер файлов и папок

<span style="color:#000000">> **du -sh** [путь]</span>  
<span style="color:#000000">> **du -sh *** — размер всех папок и файлов в текущем каталоге</span>

### Скачивание файлов с удаленного сервера

> **wget --progress=bar http://www.site.ru/backup/file.tar.gz** — скачать файл file.tar.gz c сайта  
Примечание: можно использовть ключ: **--progress=dot**

**> rsync** — аналогичная команда (см. ниже)

**# Копирование файла с удаленного сервера в текущий каталог**  
> scp root@31.193.195.61:/backup/www/2014-08-01/imodels.tar.gz imodels.tar.gz  
> scp **-P 2200** root@31.193.195.61:/backup/www/2014-08-01/imodels.tar.gz imodels.tar.gz   **— С указанием порта**  

**# Копирование файла (из текущего каталога) на удаленный сервер (в каталог)**  
> scp imodels.tar.gz root@31.193.195.61:/backup/www/2014-08-01/  
> scp **-P 2200** imodels.tar.gz root@31.193.195.61:/backup/www/2014-08-01/   **— С указанием порта**

_**Примечание:**  
Общая идея: csp [-P порт] <откуда> <куда>  
Пути к каталогам могут не быть как можно предположить из видимой структуры файлов в среде разработки или файловом менеджере,  
по этой причине могут появляться ошибки типа - is not a directory,  
реальный адрес (относительно корня сервера) можно узнать через команду pwd  
_

_Аналогично можно копировать каталоги целиком не архивируя_:  

**Скопировать всё содержимое папки на сервере (рекурсивно) в локальную папку (с подробным выводом):**  
> scp -r root@server.my:/home/dir/ /home/local/my/  

**Копирование между серверами:**  
> scp -r root@server1.my:/home/dir/ root@server2.my:/home/dir/  

**Копирование с указанием порта:**  
> scp -P 9999 file.zip user@server.my:~/

**Дополнительные флаги:**  
-r - рекурсивное копирование (для директорий)  
-C - использовать сжатие при передачи  
-P - порт ssh_**:**_  
http://wiki.enchtex.info/tools/console/scp

### **rsync**

**Копирование папки с сайтом на другой сервер с помощью команды rsync**  

Сначала нужно на сервере, с которого копируем перейти в каталог, который копируем и ввести команды  
Например текущий каталог на сервере, с которого делаем копирование: /home/bitrix/www/activecloud/httpdocs/www/doktorvolos.ru      

Копирование каталога: doktorvolos.ru:  
**rsync -e 'ssh -p22' -aH --delete  --exclude="CACHE/*" --progress -lzuogthvr --compress-level=9 ./ admin_ftp_1112@89.253.222.124:/var/www/vhosts/doktorvolos.ru/httpdocs/doktorvolos.ru/**  

Копирование каталога bitrix:  
**rsync -e 'ssh -p22' -aH --delete  --exclude="CACHE/*" --progress -lzuogthvr --compress-level=9 ./bitrix/ admin_ftp_1112@89.253.222.124:/var/www/vhosts/doktorvolos.ru/httpdocs/doktorvolos.ru/bitrix/**  

Копирование каталога upload:  
**rsync -e 'ssh -p22' -aH --delete  --exclude="CACHE/*" --progress -lzuogthvr --compress-level=9 ./upload/ admin_ftp_1112@89.253.222.124:/var/www/vhosts/doktorvolos.ru/httpdocs/doktorvolos.ru/upload/**  

**Примечание:**  
**admin_ftp_1112@89.253.222.124** - логин (доступ) и host сервера, на который копируем  
После вставки команды в консоль система спросит пароль на сервер, на который делается копирование (вставляем пароль, дальше идет копирование с выводом списка файлов на экран)

### Работа с архивами

Пусть мы скачали один архив разбитый на два файла: archive.tar.gz, archive.tar.gz2  
Эти два архива можно слить в один файл командой:

> **cat archive.tar* > newfile.tar.gz** — слияние архивов * означает любые символы

> **tar -xzf newfile.tar.gz** — разархивация файла, разархивированные файлы кладутся в соответствии с путями (если исходный архив находится в корне сайта)работает для архивов: *****.tar.bz2**, ***.tar.bzip2**, ***.tbz2**, ***.tb2**, ***.tbz**  

**> **gzip -d willstream.gz** — разархивация файла запакованного как .gz

### Cимволические ссылки

создать симлинк:  
ln -s [адрес источника] [местоположение ссылки]  
ln -s ../bitrix bitrix - создание симлинка с именем bitrix в текущей дирректории, адрес ссылки ../bitrix/ (каталог bitrix родительского каталога)

### Работа с сетью

> **whois dmt.ru** — получение информации о сайте dmt.ru с помощью сервиса whois

> **host dmt.ru** — получение информации о DNS сайта  
> **host -a dmt.ru** - получение расширенную инфу о DNS сайта

### **Работа с MYSQL**

> `**mysql**` — переход в режим mysql`  
> **mysql –uUSERNAME –pPASSWORD -hHOST** — подключение к MySQL демону`**  
(Указываются доступы к Базе данных, а не к SSH).**`  
`

`Далее находимся в режиме mysql`

**_Типовой порядок действий по созданию базы данных (выполняются в режиме mysql>):_**

- Создать базу данных  
- Назначить права к базе  
- Перезагрузить демон MYSQL

Примечание:  
**_В режиме команд mysql в конце строк обязательно необходимо ставить точку с запятой (;)_  
_Используются кавычки типа: `текст в кавычках`_  
**

`mysql`> **create database baby_dmt;** — создать базу данных baby_dmt  
`mysql`> **grant all privileges on baby_dmt.* to baby_dmt@'localhost' identified by 'PASSWORD';** — назначение прав на базу (указывается база и пароль)

`mysql`> **exit** — Выход из режима MYSQL  
> **service mysql restart** — перезапуск демона MySQL

Типовой порядок действий для существующей базы данных:

``mysql`>``<span class="operator">** <span class="keyword">SHOW</span> DATABASES;** — показать все базы данных  
`mysql`></span> ``**<span class="keyword">USE</span> database;** — переключится на базу database  
mysql>``** <span class="pln">describe</span> <span class="pun">*</span> <span class="pln"></span> <span class="kwd">from</span> <span class="pln">myDB</span>**<span class="pun">**;** - получить описание по всем таблицам  
mysql> **describe `table1`;** - посмотреть структуру таблицы table1  
`mysql`></span>``<span class="operator">** <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">table</span>;** - получить значение полей из таблицы  
``mysql`>``**<span class="keyword">SELECT</span> * <span class="keyword">FROM</span>** <span class="keyword">**table /G;** - `- получить значение полей из таблицы с разбивкой по строкам (так удобнее)`</span>`</span>`

**Запись сайта в базу заявок:**

<address>

`<span class="operator">`mysql`></span> ``**<span class="keyword">USE</span> myTable;  - Выбор таблицы, с которой будем работать   
**``<span class="operator">`mysql`></span> `**INSERT INTO  myTable VALUES ('17','l38','text');**  - Запись данных в поле таблицы 

</address>

**<span class="operator keyword">Комманды для распаковки и создания бэкапов MYSQL</span>**

<span class="operator keyword">Вне режима mysql</span>**<span class="operator keyword">:  
</span>**

<span class="operator keyword">></span> **<span class="operator keyword">mysql dbname < file.sql</span> **<span class="operator keyword">— залить файл file.sql в базу dbname  
</span>

<span class="operator keyword">> **mysqldump baby_dmt > baby_dmt.sql** — создание файла дампа базы (бэкапа) из базы baby_dmt в файл baby_dmt.sql</span>

<span class="operator keyword">Если предыдущая команда не проходит (возможно из-за недостаточных прав)  
`> **<span class="operator keyword">`****mysqldump** **`</span>-uUSERNAME -pPASSWORD <span class="operator keyword">**baby_dmt > baby_dmt.sql**</span>**<span class="operator keyword">  -</span> <span class="operator keyword">Если пользователь без прав root (сначала указываем **команду, логин и пароль от БАЗЫ, затем действия** </span><span class="operator keyword">)</span>`</span>

**Поиск текста в файлах**  
Переходим в папку, в которой собираемся искать текст (с помощью команды cd):  
**> grep -r "text in files" ./**

**Запуск bash скрипта из консоли:**

**> sh bash_script.sh**
